(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5278:function(e,t,a){Promise.resolve().then(a.bind(a,4462))},4462:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return I}});var s=a(7437),r=a(2265);let i={tripData:null,isLoading:!1,error:null,messages:[]},n=(e,t)=>{switch(t.type){case"SET_TRIP_DATA":return{...e,tripData:t.payload,isLoading:!1,error:null};case"SET_LOADING":return{...e,isLoading:t.payload};case"SET_ERROR":return{...e,error:t.payload,isLoading:!1};case"ADD_MESSAGE":return{...e,messages:[...e.messages,t.payload]};case"SET_MESSAGES":return{...e,messages:t.payload};default:return e}},o=(0,r.createContext)(void 0),l=e=>{let{children:t}=e,[a,l]=(0,r.useReducer)(n,i);return(0,s.jsx)(o.Provider,{value:{state:a,dispatch:l},children:t})},c=()=>{let e=(0,r.useContext)(o);if(void 0===e)throw Error("useTripPlanning must be used within a TripPlanningProvider");return e};var d=a(8158),m=a(2457),h=a(7307),p=a(4059),u=a(8858);let g=e=>{let t=e.filter(e=>"assistant"===e.role);if(0===t.length)return null;let a=t[t.length-1].content,s=a.match(/(?:ที่|เที่ยว|ท่องเที่ยว|เดินทาง|จังหวัด|ไป|ที่|เมือง)(?:\s+)([^\s,\.]+)/i),r=a.match(/(\d{1,2}[\s-]+\d{1,2}|วันที่\s+\d{1,2}[-\s]+\d{1,2})(?:\s+|\/)([^\s,\.]+)/i),i=a.match(/(?:งบ|งบประมาณ|ราคา|งบประมาณ|บาท|ค่าใช้จ่าย)(?:\s+)?(\d{1,3}(?:,\d{3})*)/i),n=Array.from(a.matchAll(/(?:\*\*\d+\.\s+([^:]+)\*\*:|\*\*([^:]+)\*\*:)/g)),o=n.map((e,t)=>{let s=e[1]||e[2],r=e.index+e[0].length,i=t<n.length-1?n[t+1].index:a.length,o=a.slice(r,i).trim();return{id:"activity-".concat(t),name:s,description:o,rating:4.5,openingHours:"9:00 AM - 5:00 PM",imageUrl:"/images/activities/".concat(t+1,".jpg"),category:"Attraction",highlights:x(o),location:"ตำบลสะปัน อำเภอปัว จังหวัดน่าน",price:"฿100-300",bestTimeToVisit:"ตุลาคม-กุมภาพันธ์"}});return{destination:s?s[1]:"น่าน",departure:"กรุงเทพ",startDate:r?r[1]:"12 สิงหาคม",endDate:"15 สิงหาคม",travelers:"2",budget:i?i[1]:"15,000",activities:o.length>0?o:b("น่าน"),restaurants:y("น่าน"),flights:v("น่าน"),videos:w("น่าน"),accommodations:j("น่าน")}},x=e=>e.split(/\n/).filter(e=>e.trim().startsWith("*")||e.trim().match(/^\d+\./)).map(e=>e.replace(/^\*|\d+\.\s*/,"").trim()).filter(e=>e.length>0).slice(0,3),f=e=>{if(!e)return(0,s.jsx)(s.Fragment,{});let t=e.split(/\n\n+/);return(0,s.jsx)(s.Fragment,{children:t.map((e,t)=>{if(e.trim().startsWith("**")&&e.trim().endsWith("**"))return(0,s.jsx)("h3",{className:"text-xl font-bold text-primary-700 mt-6 mb-3",children:e.replace(/\*\*/g,"")},t);if(e.match(/^\d+\./)){let a=e.split(/\n/).filter(e=>e.trim());return(0,s.jsx)("div",{className:"mb-4",children:a.map((e,t)=>{let a=e.match(/^(\d+)\.(.+)/);if(a){let[,e,r]=a;return(0,s.jsxs)("div",{className:"flex items-start mb-3",children:[(0,s.jsx)("div",{className:"bg-primary-100 rounded-full w-8 h-8 flex items-center justify-center text-primary-700 font-bold mr-3 flex-shrink-0",children:e}),(0,s.jsx)("div",{className:"flex-1",children:r.includes("**")?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"font-semibold text-gray-900",children:r.replace(/^\s*\*\*|\*\*\s*:$/g,"")})}):(0,s.jsx)("p",{children:r.trim()})})]},t)}return(0,s.jsx)("p",{className:"ml-11 text-gray-700",children:e},t)})},t)}return e.toLowerCase().includes("งบประมาณ")||e.toLowerCase().includes("บาท")?(0,s.jsxs)("div",{className:"bg-amber-50 border-l-4 border-amber-300 p-4 my-4 rounded-r-lg",children:[(0,s.jsx)("h4",{className:"font-semibold text-amber-800 mb-2",children:"\uD83D\uDC67"}),(0,s.jsx)("p",{className:"text-gray-700",children:e})]},t):e.toLowerCase().includes("ข้อควรระวัง")||e.toLowerCase().includes("ข้อควรคำนึง")||e.toLowerCase().includes("หมายเหตุ")?(0,s.jsxs)("div",{className:"bg-blue-50 border-l-4 border-blue-300 p-4 my-4 rounded-r-lg",children:[(0,s.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"ข้อควรทราบ"}),(0,s.jsx)("p",{className:"text-gray-700",children:e})]},t):(0,s.jsx)("p",{className:"mb-4 text-gray-700",children:e},t)})})},b=e=>[{id:"activity-1",name:"น้ำตกสะปัน",description:"น้ำตกที่สวยงามและใหญ่ที่สุดในอำเภอสะปัน คุณสามารถเดินป่าศึกษาธรรมชาติและเพลิดเพลินกับความสดชื่นของธรรมชาติได้",rating:4.7,openingHours:"8:00 AM - 6:00 PM",imageUrl:"/images/activities/1.jpg",category:"ธรรมชาติ",location:"อำเภอสะปัน จังหวัดน่าน",price:"฿20-50",highlights:["เดินป่าศึกษาธรรมชาติ","ชมน้ำตกที่สวยงาม","สัมผัสความสดชื่นของธรรมชาติ"],bestTimeToVisit:"มิถุนายน-ตุลาคม"},{id:"activity-2",name:"ดอยเสมอดาว",description:"ถ้าคุณชื่นชอบการชมวิวภูเขาและท้องฟ้าในยามค่ำคืน ดอยเสมอดาวเป็นสถานที่ที่เหมาะสมมาก คุณสามารถกางเต็นท์นอนและชมดาวได้",rating:4.5,openingHours:"เปิดตลอดวัน",imageUrl:"/images/activities/2.jpg",category:"ธรรมชาติ",location:"อำเภอปัว จังหวัดน่าน",price:"฿100-200",highlights:["ชมวิวภูเขา","กางเต็นท์ชมดาว","อากาศเย็นสบาย"],bestTimeToVisit:"พฤศจิกายน-กุมภาพันธ์"}],y=e=>[{id:"restaurant-1",name:"ร้านอาหารเฮือนฮังต่อ",cuisine:"อาหารเหนือ",priceRange:"฿฿",rating:4.6,reviewHighlight:"อาหารเหนือรสชาติดั้งเดิม บรรยากาศดี ท่ามกลางธรรมชาติ",imageUrl:"/images/restaurants/1.jpg",location:"อำเภอปัว จังหวัดน่าน",hours:"10:00 AM - 9:00 PM",reservationRequired:!1,specialties:["แกงฮังเล","น้ำพริกหนุ่ม","ลาบหมู"]},{id:"restaurant-2",name:"กาแฟบ้านไทลื้อ",cuisine:"กาแฟและของว่าง",priceRange:"฿",rating:4.8,reviewHighlight:"กาแฟรสชาติดีเยี่ยม บรรยากาศเป็นกันเอง วิวสวย",imageUrl:"/images/restaurants/2.jpg",location:"อำเภอปัว จังหวัดน่าน",hours:"7:00 AM - 6:00 PM",reservationRequired:!1,specialties:["กาแฟดริป","ขนมไทย","เค้กโฮมเมด"]}],v=e=>[{id:"flight-1",airline:"Thai AirAsia",flightNumber:"FD3554",departure:{airport:"ดอนเมือง (DMK)",time:"07:10",date:"12 สิงหาคม 2024",terminal:"2"},arrival:{airport:"น่าน (NNT)",time:"08:30",date:"12 สิงหาคม 2024",terminal:"1"},duration:"1h 20m",price:1500,stops:0,class:"Economy",bookingUrl:"https://www.airasia.com",layover:"",cancellationPolicy:"ไม่สามารถขอเงินคืนได้",amenities:["น้ำหนักสัมภาระ 7 กก.","อาหารว่างและเครื่องดื่ม (มีค่าใช้จ่าย)"]},{id:"flight-2",airline:"Thai AirAsia",flightNumber:"FD3555",departure:{airport:"น่าน (NNT)",time:"18:15",date:"15 สิงหาคม 2024",terminal:"1"},arrival:{airport:"ดอนเมือง (DMK)",time:"19:35",date:"15 สิงหาคม 2024",terminal:"2"},duration:"1h 20m",price:1700,stops:0,class:"Economy",bookingUrl:"https://www.airasia.com",layover:"",cancellationPolicy:"ไม่สามารถขอเงินคืนได้",amenities:["น้ำหนักสัมภาระ 7 กก.","อาหารว่างและเครื่องดื่ม (มีค่าใช้จ่าย)"]}],w=e=>[{id:"video-1",title:"เที่ยว".concat(e," 3 วัน 2 คืน งบไม่เกิน 5,000 บาท"),description:"รีวิวเส้นทางท่องเที่ยว".concat(e," ครบทุกแลนด์มาร์คสำคัญ พร้อมแนะนำร้านอาหารและที่พัก"),thumbnail:"/images/videos/1.jpg",embedUrl:"https://www.youtube.com/embed/12345",duration:"15:30",viewCount:"258K",likes:"15K",channel:"Travel Thailand",publishDate:"2023-10-15"},{id:"video-2",title:"Hidden Gems in ".concat(e," - สถานที่เที่ยวสุดลับ"),description:"พาทุกคนไปสัมผัสมนต์เสน่ห์ของ".concat(e," ที่นักท่องเที่ยวทั่วไปอาจไม่รู้จัก"),thumbnail:"/images/videos/2.jpg",embedUrl:"https://www.youtube.com/embed/67890",duration:"12:45",viewCount:"124K",likes:"8.5K",channel:"Local Guide",publishDate:"2023-12-03"}],j=e=>[{id:"accommodation-1",name:"โฮมสเตย์บ้านสะปัน",type:"Homestay",rating:4.8,reviewCount:127,price:900,priceUnit:"per night",amenities:["Free Wi-Fi","Air conditioning","Private bathroom","Mountain view"],imageUrl:"/images/accommodations/1.jpg",platform:"Airbnb",bookingUrl:"https://www.airbnb.com",location:"บ้านสะปัน อำเภอปัว จังหวัดน่าน",description:"โฮมสเตย์สไตล์ล้านนาท่ามกลางขุนเขา เงียบสงบและสวยงาม เจ้าของที่พักเป็นกันเอง",distance:"0.5 km from center"},{id:"accommodation-2",name:"น่านซีรีนรีสอร์ท",type:"Resort",rating:4.6,reviewCount:203,price:1500,priceUnit:"per night",amenities:["Free Wi-Fi","Swimming pool","Restaurant","Garden","Mountain view"],imageUrl:"/images/accommodations/2.jpg",platform:"Agoda",bookingUrl:"https://www.agoda.com",location:"อำเภอเมือง จังหวัดน่าน",description:"รีสอร์ทที่ตกแต่งด้วยสไตล์ล้านนาร่วมสมัย สระว่ายน้ำและร้านอาหารมีวิวภูเขา",distance:"2.3 km from center"}];var N=e=>{let{isPlanning:t}=e,{state:a,dispatch:i}=c();(0,r.useEffect)(()=>{var e;console.log("Canvas component state:",{hasTripData:!!a.tripData,isPlanning:t,destination:(null===(e=a.tripData)||void 0===e?void 0:e.destination)||"None",messagesCount:a.messages.length,hasUserMessages:a.messages.some(e=>"user"===e.role),renderWelcomeMessage:n,renderChatOnly:x})},[a.tripData,t,a.messages.length]),(0,r.useEffect)(()=>{if(a.messages.length>0&&!a.tripData&&!t){let e=g(a.messages);e&&i({type:"SET_TRIP_DATA",payload:e})}},[a.messages,a.tripData,t,i]);let n=!a.tripData&&!t&&(0===a.messages.length||1===a.messages.length&&"assistant"===a.messages[0].role),o=t&&!a.tripData,l=!!a.tripData,x=!n&&!o&&!l;return(0,s.jsx)("div",{className:"h-full overflow-y-auto bg-gradient-to-b from-blue-50 to-white",children:l&&a.tripData&&(0,s.jsx)(u.E.div,{variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.3}}},initial:"hidden",animate:"visible",className:"p-8",children:a.messages.some(e=>"assistant"===e.role)&&(0,s.jsx)(u.E.div,{variants:{hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.6}}},children:(0,s.jsxs)("div",{className:"mt-10 bg-white rounded-2xl shadow-lg p-8 relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 right-0 w-64 h-64 bg-primary-100 rounded-full -translate-y-1/2 translate-x-1/4 opacity-70"}),(0,s.jsxs)("div",{className:"flex items-center mb-6 relative z-10",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary-100 flex items-center justify-center",children:(0,s.jsx)(d.Z,{className:"w-6 h-6 text-primary-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Your Travel Plan"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Curated by our AI Travel Assistant"})]})]}),(0,s.jsxs)("div",{className:"prose prose-lg max-w-none relative z-10",children:[(0,s.jsx)("div",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed custom-ai-content",children:f((()=>{let e=a.messages.filter(e=>"assistant"===e.role);return e.length>0?e[e.length-1].content:""})())}),(0,s.jsxs)("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4 flex items-center",children:[(0,s.jsx)(m.Z,{className:"w-5 h-5 text-blue-500 mr-3"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900",children:"สถานที่ท่องเที่ยว"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"แลนด์มาร์คที่น่าสนใจ"})]})]}),(0,s.jsxs)("div",{className:"bg-amber-50 rounded-lg p-4 flex items-center",children:[(0,s.jsx)("div",{className:"mr-3 text-amber-500 font-bold text-xl",children:"฿"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900",children:"งบประมาณ"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"แผนการใช้จ่าย"})]})]}),(0,s.jsxs)("div",{className:"bg-green-50 rounded-lg p-4 flex items-center",children:[(0,s.jsx)(h.Z,{className:"w-5 h-5 text-green-500 mr-3"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900",children:"กำหนดการ"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"แผนการเดินทางรายวัน"})]})]}),(0,s.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4 flex items-center",children:[(0,s.jsx)(p.Z,{className:"w-5 h-5 text-purple-500 mr-3"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900",children:"บริการพิเศษ"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"ข้อมูลเพิ่มเติม"})]})]})]})]})]})})})})},T=a(5083),D=a(5677),k=a(1213),S=a(6509),A=a(9990);class E{connect(){try{let e="".concat(this.backendUrl,"/api/ws/").concat(this.sessionId);this.socket=new WebSocket(e),this.socket.onopen=this.handleOpen.bind(this),this.socket.onmessage=this.handleMessage.bind(this),this.socket.onclose=this.handleClose.bind(this),this.socket.onerror=this.handleError.bind(this)}catch(e){console.error("WebSocket connection error:",e),this.handlers.onError(e)}}disconnect(){this.socket&&(this.socket.close(),this.socket=null),this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}sendMessage(e){this.socket&&this.socket.readyState===WebSocket.OPEN?this.socket.send(e):(console.error("WebSocket is not connected"),this.handlers.onError(Error("WebSocket is not connected")))}handleOpen(e){console.log("WebSocket connection established"),this.reconnectAttempts=0,this.handlers.onOpen&&this.handlers.onOpen()}handleMessage(e){try{let t=JSON.parse(e.data);t.message&&this.handlers.onMessage(t.message),t.turn_complete&&this.handlers.onTurnComplete(),t.interrupted&&this.handlers.onInterrupted&&this.handlers.onInterrupted()}catch(e){console.error("Error processing WebSocket message:",e),this.handlers.onError(e)}}handleClose(e){console.log("WebSocket connection closed: ".concat(e.code," ").concat(e.reason)),1e3!==e.code&&this.attemptReconnect(),this.handlers.onClose&&this.handlers.onClose()}handleError(e){console.error("WebSocket error:",e),this.handlers.onError(e)}attemptReconnect(){if(this.reconnectAttempts<this.maxReconnectAttempts){this.reconnectAttempts++;let e=Math.min(1e3*Math.pow(2,this.reconnectAttempts),3e4);console.log("Attempting to reconnect in ".concat(e,"ms (attempt ").concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),this.reconnectTimeout=setTimeout(()=>{console.log("Reconnecting... (attempt ".concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),this.connect()},e)}else console.error("Maximum reconnect attempts reached"),this.handlers.onError(Error("Maximum reconnect attempts reached"))}constructor(e,t){this.socket=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectTimeout=null,this.sessionId=e,this.handlers=t,this.backendUrl="http://localhost:8000";let a=this.backendUrl.startsWith("https")?"wss":"ws";this.backendUrl=this.backendUrl.replace(/^http(s?):\/\//,"".concat(a,"://"))}}var P=a(5570),C=a(8219),M=e=>{let{onSubmit:t}=e,[a,i]=(0,r.useState)({departure:"",destination:"",startDate:"",endDate:"",budgetRange:"30000"}),n=e=>e.toISOString().split("T")[0];(0,r.useEffect)(()=>{let e=new Date;e.setDate(e.getDate()+7);let t=new Date(e);t.setDate(t.getDate()+5),i(a=>({...a,startDate:n(e),endDate:n(t)}))},[]);let o=e=>{let{name:t,value:a}=e.target;i(e=>({...e,[t]:a}))};return(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t(a)},className:"bg-white p-4 rounded-lg border border-gray-200 space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4"}),"Departure Location"]})}),(0,s.jsx)("input",{type:"text",name:"departure",value:a.departure,onChange:o,placeholder:"e.g., กรุงเทพ",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4"}),"Destination"]})}),(0,s.jsx)("input",{type:"text",name:"destination",value:a.destination,onChange:o,placeholder:"e.g., เชียงใหม่",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(P.Z,{className:"w-4 h-4"}),"Start Date"]})}),(0,s.jsx)("input",{type:"date",name:"startDate",value:a.startDate,onChange:o,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(P.Z,{className:"w-4 h-4"}),"End Date"]})}),(0,s.jsx)("input",{type:"date",name:"endDate",value:a.endDate,onChange:o,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",required:!0})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(C.Z,{className:"w-4 h-4"}),"Budget Range (THB)"]})}),(0,s.jsxs)("select",{name:"budgetRange",value:a.budgetRange,onChange:o,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[(0,s.jsx)("option",{value:"ไม่เกิน ฿15,000 บาท",children:"Budget (฿ - Under ฿15,000)"}),(0,s.jsx)("option",{value:"฿15,000-฿30,000 บาท",children:"Medium (฿฿ - ฿15,000-฿30,000)"}),(0,s.jsx)("option",{value:"฿50,000 บาท",children:"Luxury (฿฿฿ - Above ฿50,000)"})]})]}),(0,s.jsx)("button",{type:"submit",className:"w-full bg-primary-500 text-white py-2 px-4 rounded-lg hover:bg-primary-600 transition-colors font-medium",children:"Plan My Trip"})]})};let R=e=>{try{let t=e.filter(e=>"assistant"===e.role);if(0===t.length)return null;console.log("Looking for trip data in assistant messages:",t.length);let a=/```json\s*({[\s\S]*?})\s*```/;for(let e=t.length-1;e>=0;e--){let s=t[e].content.match(a);if(s&&s[1])try{let e=s[1].trim();console.log("Found JSON data:",e.substring(0,100)+"...");let t=JSON.parse(e);if(t.destination&&(t.activities||t.restaurants||t.flights||t.accommodations))return console.log("Successfully parsed TripData from JSON"),t}catch(e){console.error("Error parsing JSON from message:",e)}}let s=t[t.length-1].content;console.log("Trying to extract trip data from text:",s.substring(0,100)+"...");let r=s.match(/(?:เที่ยว|ไป|ท่องเที่ยว)\s*(?:ที่|ยัง)?\s*([^,\.\n]+)/i),i=s.match(/(\d{1,2}[-\/]\d{1,2}[-\/]\d{4})\s*(?:ถึง|to|-)\s*(\d{1,2}[-\/]\d{1,2}[-\/]\d{4})/i),n=s.match(/งบประมาณ\s*(?:ประมาณ)?\s*([^,\.\n]+)(?:บาท|฿)/i),o={destination:r?r[1].trim():"Bangkok",departure:"No departure specified",startDate:i?i[1]:"2023-05-10",endDate:i?i[2]:"2023-05-15",budget:n?n[1]:"฿30,000",travelers:"2",activities:[{id:"1",name:"Grand Palace",description:"The Grand Palace is a complex of buildings at the heart of Bangkok, Thailand. The palace has been the official residence of the Kings of Siam since 1782.",rating:4.8,openingHours:"8:30 AM - 3:30 PM",imageUrl:"https://images.unsplash.com/photo-1563492065599-3520f775eeed?w=800&auto=format&fit=crop&q=60",category:"Cultural",location:"Na Phra Lan Road, Bangkok",price:"฿500 per person",highlights:["Emerald Buddha","Throne Halls","Royal decorations"],bestTimeToVisit:"Early morning"}],restaurants:[{id:"1",name:"Thipsamai Pad Thai",cuisine:"Thai",priceRange:"฿฿",rating:4.7,reviewHighlight:"The best Pad Thai in Bangkok, a must-visit for authentic Thai flavors!",imageUrl:"https://images.unsplash.com/photo-1559314809-0d155014e29e?w=800&auto=format&fit=crop&q=60",location:"Maha Chai Road, Bangkok",hours:"5:00 PM - 2:00 AM",specialties:["Pad Thai","Fresh spring rolls","Orange juice"],reservationRequired:!1},{id:"2",name:"Raan Jay Fai",cuisine:"Thai Street Food",priceRange:"฿฿฿",rating:4.9,reviewHighlight:"Michelin-starred street food that lives up to the hype. The crab omelette is legendary!",imageUrl:"https://images.unsplash.com/photo-1543352634-a1c51d9f1fa7?w=800&auto=format&fit=crop&q=60",location:"Maha Chai Road, Bangkok",hours:"2:00 PM - 12:00 AM",specialties:["Crab omelette","Drunken noodles","Tom Yum"],reservationRequired:!0}],flights:[{id:"1",airline:"Thai Airways",flightNumber:"TG102",departure:{airport:"SFO",time:"23:55",date:"2023-05-10",terminal:"I"},arrival:{airport:"BKK",time:"06:50",date:"2023-05-12",terminal:"M"},duration:"15h 55m",price:29750,class:"Economy",bookingUrl:"https://www.thaiairways.com",stops:1,layover:"2h 30m in Tokyo",amenities:["In-flight meals","Wi-Fi","Entertainment"],cancellationPolicy:"Free cancellation up to 24 hours before departure"}],videos:[{id:"1",title:"Bangkok Travel Guide - Best Things to Do",description:"Complete guide to Bangkok covering temples, markets, food, and nightlife.",thumbnail:"https://images.unsplash.com/photo-1583417319070-4a69db38a482?w=800&auto=format&fit=crop&q=60",embedUrl:"https://www.youtube.com/embed/tO01J-M3g0U",duration:"12:45",viewCount:"250K",likes:"15K",channel:"Travel Guides",publishDate:"2023-01-15"}],accommodations:[{id:"1",name:"The Siam Hotel",type:"Luxury Hotel",rating:4.9,reviewCount:342,price:8750,priceUnit:"night",amenities:["WiFi","Pool","Private Bathroom","Breakfast","Spa","Fitness Center"],imageUrl:"https://images.unsplash.com/photo-1584132967334-10e028bd69f7?w=800&auto=format&fit=crop&q=60",platform:"Agoda",bookingUrl:"https://www.agoda.com",location:"Riverside, Bangkok",description:"An urban luxury resort with exquisite design and personalized service.",distance:"5 km"}]};return console.log("Using sample trip data for testing"),o}catch(e){return console.error("Error extracting trip data:",e),null}};var _=e=>{let{onPlanningStart:t,onPlanningComplete:a}=e,{dispatch:i,state:n}=c();(0,r.useEffect)(()=>{0===n.messages.length&&i({type:"SET_MESSAGES",payload:[]})},[]);let[o,l]=(0,r.useState)(""),[d,m]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),[u,g]=(0,r.useState)(null),[x,f]=(0,r.useState)(null),[b,y]=(0,r.useState)(!1),[v,w]=(0,r.useState)(null),j=(0,r.useRef)(null),N=(0,r.useRef)(null),P=()=>{var e;null===(e=j.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{P()},[n.messages]),(0,r.useEffect)(()=>(C(),()=>{_()}),[]),(0,r.useEffect)(()=>()=>{v&&clearTimeout(v)},[v]),(0,r.useEffect)(()=>{if(!b)return;console.log("Planning trip state is active, checking for trip data..."),console.log("Current state of tripData:",n.tripData?"Has Data":"No Data");let e=R(n.messages);e&&(console.log("Setting trip data to context:",e.destination),i({type:"SET_TRIP_DATA",payload:e}),i({type:"SET_LOADING",payload:!1}),a(),y(!1),v&&(clearTimeout(v),w(null)))},[n.messages,b,i,a,n.tripData,v]);let C=()=>{if(N.current)return;p(!0),g(null);let e=Math.random().toString(36).substring(2,15);N.current=new E(e,{onOpen:()=>{m(!0),p(!1),console.log("WebSocket connected")},onMessage:e=>{if(null===x){let t=Date.now().toString();f(t),i({type:"ADD_MESSAGE",payload:{id:t,role:"assistant",content:e,timestamp:new Date}})}else i({type:"SET_MESSAGES",payload:n.messages.map(t=>t.id===x?{...t,content:t.content+e}:t)})},onTurnComplete:()=>{if(f(null),b){console.log("Turn complete, checking messages for trip data");let e=R(n.messages);e&&(console.log("Found trip data after turn completion"),i({type:"SET_TRIP_DATA",payload:e}),i({type:"SET_LOADING",payload:!1}),a(),y(!1))}},onInterrupted:()=>{f(null)},onClose:()=>{m(!1),console.log("WebSocket disconnected")},onError:e=>{g("Connection to the assistant failed. Please try again."),p(!1),m(!1),console.error("WebSocket error:",e)}}),N.current.connect()},_=()=>{N.current&&(N.current.disconnect(),N.current=null,m(!1))},U=async e=>{if(e.preventDefault(),!o.trim())return;if(!d){h||C(),g("Connecting to the assistant. Please try again in a moment.");return}let s=o.toLowerCase().includes("วางแผนการเดินทาง")||o.toLowerCase().includes("ไปเที่ยว")||o.toLowerCase().includes("plan a trip");if(s&&(y(!0),t(),i({type:"SET_LOADING",payload:!0}),v&&clearTimeout(v),w(setTimeout(()=>{console.log("Timer expired, forcing trip data update with sample data");let e=R(n.messages);e&&(i({type:"SET_TRIP_DATA",payload:e}),i({type:"SET_LOADING",payload:!1}),a(),y(!1))},1e4))),i({type:"ADD_MESSAGE",payload:{id:Date.now().toString(),role:"user",content:o,timestamp:new Date}}),N.current)try{N.current.sendMessage(o)}catch(e){console.error("Failed to send message:",e),g("Failed to send message. Please try again."),s&&(i({type:"SET_LOADING",payload:!1}),a(),y(!1),v&&(clearTimeout(v),w(null)))}else g("Not connected to the assistant. Please refresh the page."),s&&(i({type:"SET_LOADING",payload:!1}),a(),y(!1),v&&(clearTimeout(v),w(null)));l("")},I=async e=>{if(!d){h||C(),g("Connecting to the assistant. Please try again in a moment.");return}y(!0),t(),i({type:"SET_LOADING",payload:!0}),v&&clearTimeout(v),w(setTimeout(()=>{console.log("Trip input timer expired, forcing update with sample data"),i({type:"SET_TRIP_DATA",payload:{destination:e.destination,departure:e.departure,startDate:e.startDate,endDate:e.endDate,budget:e.budgetRange,travelers:"2",activities:[{id:"1",name:"Grand Palace",description:"The Grand Palace is a complex of buildings at the heart of Bangkok, Thailand. The palace has been the official residence of the Kings of Siam since 1782.",rating:4.8,openingHours:"8:30 AM - 3:30 PM",imageUrl:"https://images.unsplash.com/photo-1563492065599-3520f775eeed?w=800&auto=format&fit=crop&q=60",category:"Cultural",location:"Na Phra Lan Road, Bangkok",price:"฿500 per person",highlights:["Emerald Buddha","Throne Halls","Royal decorations"],bestTimeToVisit:"Early morning"}],restaurants:[{id:"1",name:"Thipsamai Pad Thai",cuisine:"Thai",priceRange:"฿฿",rating:4.7,reviewHighlight:"The best Pad Thai in Bangkok, a must-visit for authentic Thai flavors!",imageUrl:"https://images.unsplash.com/photo-1559314809-0d155014e29e?w=800&auto=format&fit=crop&q=60",location:"Maha Chai Road, Bangkok",hours:"5:00 PM - 2:00 AM",specialties:["Pad Thai","Fresh spring rolls","Orange juice"],reservationRequired:!1},{id:"2",name:"Raan Jay Fai",cuisine:"Thai Street Food",priceRange:"฿฿฿",rating:4.9,reviewHighlight:"Michelin-starred street food that lives up to the hype. The crab omelette is legendary!",imageUrl:"https://images.unsplash.com/photo-1543352634-a1c51d9f1fa7?w=800&auto=format&fit=crop&q=60",location:"Maha Chai Road, Bangkok",hours:"2:00 PM - 12:00 AM",specialties:["Crab omelette","Drunken noodles","Tom Yum"],reservationRequired:!0}],flights:[{id:"1",airline:"Thai Airways",flightNumber:"TG102",departure:{airport:"SFO",time:"23:55",date:e.startDate,terminal:"I"},arrival:{airport:"BKK",time:"06:50",date:e.startDate,terminal:"M"},duration:"15h 55m",price:29750,class:"Economy",bookingUrl:"https://www.thaiairways.com",stops:1,layover:"2h 30m in Tokyo",amenities:["In-flight meals","Wi-Fi","Entertainment"],cancellationPolicy:"Free cancellation up to 24 hours before departure"}],videos:[{id:"1",title:"".concat(e.destination," Travel Guide - Best Things to Do"),description:"Complete guide to ".concat(e.destination," covering temples, markets, food, and nightlife."),thumbnail:"https://images.unsplash.com/photo-1583417319070-4a69db38a482?w=800&auto=format&fit=crop&q=60",embedUrl:"https://www.youtube.com/embed/tO01J-M3g0U",duration:"12:45",viewCount:"250K",likes:"15K",channel:"Travel Guides",publishDate:"2023-01-15"}],accommodations:[{id:"1",name:"Luxury Resort",type:"Luxury Hotel",rating:4.9,reviewCount:342,price:8750,priceUnit:"night",amenities:["WiFi","Pool","Private Bathroom","Breakfast","Spa","Fitness Center"],imageUrl:"https://images.unsplash.com/photo-1584132967334-10e028bd69f7?w=800&auto=format&fit=crop&q=60",platform:"Agoda",bookingUrl:"https://www.agoda.com",location:"Downtown, ".concat(e.destination),description:"An urban luxury resort with exquisite design and personalized service.",distance:"5 km"}]}}),i({type:"SET_LOADING",payload:!1}),a(),y(!1)},1e4));let s="ช่วยวางแผนการเดินทางท่องเที่ยวแบบละเอียดที่สุด ตามเงื่อนไขต่อไปนี้ :\n- ต้นทาง: ".concat(e.departure,"\n- ปลายทาง: ").concat(e.destination,"\n- ช่วงเวลาเดินทาง: วันที่: ").concat(e.startDate," ถึงวันที่ ").concat(e.endDate,"\n- งบประมาณรวม: ").concat(e.budgetRange,"\n      \nสิ่งที่ต้องการให้ระบุในแผนการเดินทาง:\n\n      - รายละเอียดการเดินทางไป-กลับ (เช่น รถยนต์, เครื่องบิน, รถทัวร์ พร้อมเวลาเดินทางและราคาค่าโดยสาร)\n\n      - สถานที่ท่องเที่ยวสำคัญที่ควรแวะชมในแต่ละวัน (เน้นสถานที่สำคัญทางวัฒนธรรม ธรรมชาติ และจุดถ่ายรูปยอดนิยม)\n\n      - ที่พักแนะนำ (เน้นที่พักคุณภาพดี ราคาคุ้มค่า ทำเลสะดวก พร้อมราคาต่อคืน)\n\n      - ร้านอาหารแนะนำ (ระบุชื่อร้าน ประเภทอาหาร เมนูเด็ดที่ต้องลอง และราคาคร่าวๆ ต่อมื้อ)\n\n      - กิจกรรมที่น่าสนใจห้ามพลาดใน ").concat(e.destination," (เช่น เที่ยวชมวัด ปั่นจักรยาน วิถีชุมชน ชมวิว ถ่ายภาพ)\n\n      แจกแจงค่าใช้จ่ายแต่ละวันให้ชัดเจน (รวมยอดค่าใช้จ่ายทั้งหมดไม่เกินงบที่ระบุไว้ ").concat(e.budgetRange,") \n\n\n      แนะนำเคล็ดลับหรือข้อควรระวัง เพื่อให้การเดินทางสะดวก ปลอดภัย และประทับใจมากที่สุด\n\n      ขอผลลัพธ์ในรูปแบบที่อ่านเข้าใจง่าย ชัดเจน พร้อมจัดตารางให้ดูสวยงามและใช้งานง่ายที่สุด\n    ");if(i({type:"ADD_MESSAGE",payload:{id:Date.now().toString(),role:"user",content:s,timestamp:new Date}}),N.current)try{N.current.sendMessage(s)}catch(e){console.error("Failed to send trip planning request:",e),g("Failed to send trip planning request. Please try again."),setTimeout(()=>{let e=R(n.messages);e&&i({type:"SET_TRIP_DATA",payload:e}),i({type:"SET_LOADING",payload:!1}),a(),y(!1)},2e3),v&&(clearTimeout(v),w(null))}else g("Not connected to the assistant. Please refresh the page."),setTimeout(()=>{let e=R(n.messages);e&&i({type:"SET_TRIP_DATA",payload:e}),i({type:"SET_LOADING",payload:!1}),a(),y(!1)},2e3),v&&(clearTimeout(v),w(null))};return(0,s.jsxs)("div",{className:"h-full flex flex-col bg-gray-50",children:[(0,s.jsx)("div",{className:"bg-white border-b border-gray-200 p-4",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"AI Chat Assistant"}),h?(0,s.jsxs)("div",{className:"flex items-center text-amber-600 text-sm",children:[(0,s.jsx)(T.Z,{className:"w-4 h-4 mr-1 animate-spin"}),(0,s.jsx)("span",{children:"Connecting..."})]}):d?(0,s.jsxs)("div",{className:"flex items-center text-green-600 text-sm",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-500 mr-1"}),(0,s.jsx)("span",{children:"Connected"})]}):(0,s.jsxs)("div",{className:"flex items-center text-rose-600 text-sm",children:[(0,s.jsx)(D.Z,{className:"w-4 h-4 mr-1"}),(0,s.jsx)("span",{children:"Disconnected"})]})]})}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[u&&(0,s.jsx)("div",{className:"bg-rose-50 border border-rose-200 rounded-lg p-3 text-rose-600 text-sm",children:u}),(0,s.jsx)(M,{onSubmit:I}),n.messages.map(e=>(0,s.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"flex gap-3 max-w-[80%] ".concat("user"===e.role?"flex-row-reverse":"flex-row"),children:[(0,s.jsx)("div",{className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ".concat("user"===e.role?"bg-primary-500":"bg-gray-200"),children:"user"===e.role?(0,s.jsx)(k.Z,{className:"w-5 h-5 text-white"}):(0,s.jsx)(S.Z,{className:"w-5 h-5 text-gray-600"})}),(0,s.jsxs)("div",{className:"rounded-lg px-4 py-2 ".concat("user"===e.role?"bg-primary-500 text-white":"bg-white border border-gray-200"),children:[(0,s.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.content}),(0,s.jsx)("p",{className:"text-xs mt-1 ".concat("user"===e.role?"text-primary-200":"text-gray-500"),children:e.timestamp.toLocaleTimeString()})]})]})},e.id)),(0,s.jsx)("div",{ref:j})]}),(0,s.jsx)("form",{onSubmit:U,className:"p-4 bg-white border-t border-gray-200",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:o,onChange:e=>l(e.target.value),placeholder:"Type your message...",className:"flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"}),(0,s.jsx)("button",{type:"submit",className:"bg-primary-500 text-white rounded-lg p-2 hover:bg-primary-600 transition-colors",children:(0,s.jsx)(A.Z,{className:"w-5 h-5"})})]})})]})},U=()=>(0,s.jsx)("header",{className:"bg-white shadow-sm",children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"bg-primary-500 p-2 rounded-lg",children:(0,s.jsx)(d.Z,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Travel Planner"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"AI-Powered Trip Planning Assistant"})]})]})})}),I=function(){let[e,t]=(0,r.useState)(!1);return(0,s.jsx)(l,{children:(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50",children:[(0,s.jsx)(U,{}),(0,s.jsx)("main",{className:"container mx-auto px-4 py-6",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 h-[calc(100vh-8rem)]",children:[(0,s.jsx)("div",{className:"lg:col-span-8 bg-white rounded-xl shadow-lg overflow-hidden",children:(0,s.jsx)(N,{isPlanning:e})}),(0,s.jsx)("div",{className:"lg:col-span-4 bg-white rounded-xl shadow-lg overflow-hidden",children:(0,s.jsx)(_,{onPlanningStart:()=>t(!0),onPlanningComplete:()=>t(!1)})})]})})]})})}}},function(e){e.O(0,[83,971,69,744],function(){return e(e.s=5278)}),_N_E=e.O()}]);